/*!
 * Calendar Dialog - 一个日历弹框，可以通过此日历组件选择日期、时间和标记日程等，支持多种主体，可配置化的设计思想；代码采用模块化开发，易于理解，可以很方便的进行二次开发。 
 * git+https://github.com/hai2007/calendar-dialog.git
 *
 * author 你好2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.1.1
 *
 * Copyright (c) 2021 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Wed Dec 01 2021 17:56:17 GMT+0800 (中国标准时间)
 */
(function(){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function(obj){return typeof obj}}else{_typeof=function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}
/*!
   * 🌐 - 提供常用的DOM操作方法
   * https://github.com/hai2007/browser.js/blob/master/xhtml.js
   *
   * author hai2007 < https://hai2007.gitee.io/sweethome >
   *
   * Copyright (c) 2021-present hai2007 走一步，再走一步。
   * Released under the MIT license
   */var namespace={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var xhtml={stopPropagation:function stopPropagation(event){event=event||window.event;if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}},preventDefault:function preventDefault(event){event=event||window.event;if(event.preventDefault){event.preventDefault()}else{event.returnValue=false}},isNode:function isNode(param){return param&&(param.nodeType===1||param.nodeType===9||param.nodeType===11)},bind:function bind(dom,eventType,callback){if(dom.constructor===Array||dom.constructor===NodeList||dom.constructor===HTMLCollection){for(var i=0;i<dom.length;i++){this.bind(dom[i],eventType,callback)}return}if(window.attachEvent)dom.attachEvent("on"+eventType,callback);else dom.addEventListener(eventType,callback,false)},unbind:function unbind(dom,eventType,handler){if(dom.constructor===Array||dom.constructor===NodeList||dom.constructor===HTMLCollection){for(var i=0;i<dom.length;i++){this.unbind(dom[i],eventType,handler)}return}if(window.detachEvent)dom.detachEvent("on"+eventType,handler);else dom.removeEventListener(eventType,handler,false)},find:function find(context,selectFun,tagName){if(!this.isNode(context))return[];var nodes=context.getElementsByTagName(tagName||"*");var result=[];for(var i=0;i<nodes.length;i++){if(this.isNode(nodes[i])&&(typeof selectFun!="function"||selectFun(nodes[i])))result.push(nodes[i])}return result},children:function children(dom,selectFun){var nodes=dom.childNodes;var result=[];for(var i=0;i<nodes.length;i++){if(this.isNode(nodes[i])&&(typeof selectFun!="function"||selectFun(nodes[i])))result.push(nodes[i])}return result},hasClass:function hasClass(dom,clazzs,notStrict){if(clazzs.constructor!==Array)clazzs=[clazzs];var class_str=" "+(dom.getAttribute("class")||"")+" ";for(var i=0;i<clazzs.length;i++){if(class_str.indexOf(" "+clazzs[i]+" ")>=0){if(notStrict)return true}else{if(!notStrict)return false}}return true},removeClass:function removeClass(dom,clazz){var oldClazz=" "+(dom.getAttribute("class")||"")+" ";var newClazz=oldClazz.replace(" "+clazz.trim()+" "," ");dom.setAttribute("class",newClazz.trim())},addClass:function addClass(dom,clazz){if(this.hasClass(dom,clazz))return;var oldClazz=dom.getAttribute("class")||"";dom.setAttribute("class",oldClazz+" "+clazz)},toNode:function toNode(template,isSvg){var frame;if(isSvg)frame=document.createElementNS(namespace.svg,"svg");else{var frameTagName="div";if(/^<tr[> ]/.test(template)){frameTagName="tbody"}else if(/^<th[> ]/.test(template)||/^<td[> ]/.test(template)){frameTagName="tr"}else if(/^<thead[> ]/.test(template)||/^<tbody[> ]/.test(template)){frameTagName="table"}frame=document.createElement(frameTagName)}frame.innerHTML=template;var childNodes=frame.childNodes;for(var i=0;i<childNodes.length;i++){if(this.isNode(childNodes[i]))return childNodes[i]}},trigger:function trigger(dom,eventType){if(document.createEventObject){dom.fireEvent("on"+eventType,document.createEventObject())}else{var _event=document.createEvent("HTMLEvents");_event.initEvent(eventType,true,false);dom.dispatchEvent(_event)}},getStyle:function getStyle(dom,name){var allStyle=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(dom,null):dom.currentStyle;return typeof name==="string"?allStyle.getPropertyValue(name):allStyle},offsetPosition:function offsetPosition(dom){var left=0;var top=0;top=dom.offsetTop;left=dom.offsetLeft;dom=dom.offsetParent;while(dom){top+=dom.offsetTop;left+=dom.offsetLeft;dom=dom.offsetParent}return{left:left,top:top}},mousePosition:function mousePosition(dom,event){var bounding=dom.getBoundingClientRect();if(!event||!event.clientX)throw new Error("Event is necessary!");return{x:event.clientX-bounding.left,y:event.clientY-bounding.top}},remove:function remove(dom){dom.parentNode.removeChild(dom)},setStyles:function setStyles(dom,styles){for(var key in styles){dom.style[key]=styles[key]}},size:function size(dom,type){var elemHeight,elemWidth;if(type=="content"){elemWidth=dom.clientWidth-(this.getStyle(dom,"padding-left")+"").replace("px","")-(this.getStyle(dom,"padding-right")+"").replace("px","");elemHeight=dom.clientHeight-(this.getStyle(dom,"padding-top")+"").replace("px","")-(this.getStyle(dom,"padding-bottom")+"").replace("px","")}else if(type=="padding"){elemWidth=dom.clientWidth;elemHeight=dom.clientHeight}else if(type=="border"){elemWidth=dom.offsetWidth;elemHeight=dom.offsetHeight}else if(type=="scroll"){elemWidth=dom.scrollWidth;elemHeight=dom.scrollHeight}else{elemWidth=dom.offsetWidth;elemHeight=dom.offsetHeight}return{width:elemWidth,height:elemHeight}},append:function append(el,template){var node=this.isNode(template)?template:this.toNode(template);el.appendChild(node);return node},prepend:function prepend(el,template){var node=this.isNode(template)?template:this.toNode(template);el.insertBefore(node,el.childNodes[0]);return node},after:function after(el,template){var node=this.isNode(template)?template:this.toNode(template);el.parentNode.insertBefore(node,el.nextSibling);return node},before:function before(el,template){var node=this.isNode(template)?template:this.toNode(template);el.parentNode.insertBefore(node,el);return node}};function dragdrop(){var el=document.getElementById("calendar-dialog_move");xhtml.bind(el,"mousedown",(function mousedown(event){el.setCapture&&el.setCapture();var _el=el.parentNode;var lf=event.clientX;var tp=event.clientY;var left=xhtml.getStyle(_el,"left").replace("px","");var top=xhtml.getStyle(_el,"top").replace("px","");function mousemove(event){_el.style.left=left- -event.clientX-lf+"px";_el.style.top=top- -event.clientY-tp+"px"}xhtml.bind(document,"mousemove",mousemove);xhtml.bind(document,"mouseup",(function(event){xhtml.unbind(document,"mousemove",mousemove);_el.releaseCapture&&_el.releaseCapture();return false}))}))}var calcDays=function calcDays(year,month){if(month==2){if(year%4!=0||year%100==0&&year%400!=0){return 28}else{return 29}}else{return[31,-1,31,30,31,30,31,31,30,31,30,31][month-1]}};function calcYears(year){var beginYear=+(Math.floor(year/10)+"0");return[beginYear,beginYear+1,beginYear+2,beginYear+3,beginYear+4,beginYear+5,beginYear+6,beginYear+7,beginYear+8,beginYear+9]}function calcDaysArray(year,month){var index=new Date(year+"/"+month+"/1").getDay();var preNum=index-1;if(preNum==-1)preNum=7;var curNum=calcDays(year,month);var nextNum=42-preNum-curNum;var daysArray={pre:[],cur:[],next:[]};var preMonthDays=calcDays(month==1?year-1:year,month==1?12:month-1);for(var i=preNum;i>0;i--){daysArray.pre.push(preMonthDays-i+1)}for(var _i=1;_i<=curNum;_i++){daysArray.cur.push(_i)}for(var _i2=1;_i2<=nextNum;_i2++){daysArray.next.push(_i2)}return daysArray}var months=["一","二","三","四","五","六","七","八","九","十","十一","十二"];function selectDayView(year,month){var daysArray=calcDaysArray(year,month);var preTemplate="";for(var i=0;i<daysArray.pre.length;i++){preTemplate+="<span class='gray'>"+daysArray.pre[i]+"</span>"}var curTemplate="";for(var _i=0;_i<daysArray.cur.length;_i++){curTemplate+="<span tag='"+daysArray.cur[_i]+"'>"+daysArray.cur[_i]+"</span>"}var nextTemplate="";for(var _i2=0;_i2<daysArray.next.length;_i2++){nextTemplate+="<span class='gray'>"+daysArray.next[_i2]+"</span>"}var template='\n<div class="header">\n    <button>&lt;</button>\n    <h3>'.concat(months[month-1],"月 ").concat(year,'</h3>\n    <button>&gt;</button>\n</div>\n<div class="title"><span>一</span><span>二</span><span>三</span><span>四</span><span>五</span><span>六</span><span>日</span></div>\n<div class="items dayview">').concat(preTemplate).concat(curTemplate).concat(nextTemplate,"</div>");document.getElementById("calendar-dialog_view").innerHTML=template;var viewDom=document.getElementById("calendar-dialog_view");xhtml.bind(viewDom.getElementsByTagName("button")[0],"click",(function(){selectDayView(month==1?year-1:year,month==1?12:month-1)}));xhtml.bind(viewDom.getElementsByTagName("h3")[0],"click",(function(){selectMonthView(year)}));xhtml.bind(viewDom.getElementsByTagName("button")[1],"click",(function(){selectDayView(month==12?year+1:year,month==12?1:month+1)}));xhtml.bind(viewDom.getElementsByTagName("span"),"click",(function(event){var tag=event.target.getAttribute("tag");if(tag!==null){var dialog=document.getElementById("calendar-dialog");dialog.__doSelected__(year,month,+tag);dialog.style.display="none"}}))}function selectMonthView(year){var curTemplate="";for(var i=1;i<=12;i++){curTemplate+="<span tag='"+i+"'>"+months[i-1]+"月</span>"}var template='\n<div class="header">\n    <button>&lt;</button>\n    <h3>'.concat(year,'年</h3>\n    <button>&gt;</button>\n</div>\n<div class="items monthview">').concat(curTemplate,"</div>");document.getElementById("calendar-dialog_view").innerHTML=template;var viewDom=document.getElementById("calendar-dialog_view");xhtml.bind(viewDom.getElementsByTagName("button")[0],"click",(function(){selectMonthView(year-1)}));xhtml.bind(viewDom.getElementsByTagName("h3")[0],"click",(function(){selectYearView(year)}));xhtml.bind(viewDom.getElementsByTagName("button")[1],"click",(function(){selectMonthView(year+1)}));xhtml.bind(viewDom.getElementsByTagName("span"),"click",(function(event){var tag=event.target.getAttribute("tag");if(tag!==null){selectDayView(year,+tag)}}))}function selectYearView(year){var years=calcYears(year);var minYears=years[0];var maxYears=years[years.length-1];var curTemplate="<span class='gray'>"+(minYears-1)+"年</span>";for(var i=0;i<years.length;i++){curTemplate+="<span tag='"+years[i]+"'>"+years[i]+"年</span>"}curTemplate+="<span class='gray'>"+(maxYears+1)+"年</span>";var template='\n<div class="header">\n    <button>&lt;</button>\n    <h3>'.concat(minYears,"年 ~ ").concat(maxYears,'年</h3>\n    <button>&gt;</button>\n</div>\n<div class="items yearview">').concat(curTemplate,"</div>");document.getElementById("calendar-dialog_view").innerHTML=template;var viewDom=document.getElementById("calendar-dialog_view");xhtml.bind(viewDom.getElementsByTagName("button")[0],"click",(function(){selectYearView(year-10)}));xhtml.bind(viewDom.getElementsByTagName("button")[1],"click",(function(){selectYearView(year+10)}));xhtml.bind(viewDom.getElementsByTagName("span"),"click",(function(event){var tag=event.target.getAttribute("tag");if(tag!==null){selectMonthView(+tag)}}))}var $RegExp={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};function analyseBlock(source){var i=-1,currentChar=null;var next=function next(){currentChar=i++<source.length-1?source[i]:null;return currentChar};var nextNValue=function nextNValue(n){return source.substring(i,n+i>source.length?source.length:n+i)};var blocks=[];var currentBlock="";next();while(true){while($RegExp.blankReg.test(currentChar)){next()}if(currentChar==null)break;if(nextNValue(2)=="/*"){next();next();currentBlock="/*";while(nextNValue(2)!="*/"&&currentChar!=null){currentBlock+=currentChar;next()}if(currentChar==null){throw new Error("The comment is not closed.")}currentBlock+="*/";next();next();blocks.push({value:currentBlock,type:"comment-double"})}else if(nextNValue(2)=="//"){currentBlock="";while(currentChar!="\n"&&currentChar!=null){currentBlock+=currentChar;next()}blocks.push({value:currentBlock,type:"comment-single"})}else if(currentChar=="}"){blocks.push({value:"}",type:"end"});next()}else{currentBlock="";while(currentChar!="{"&&currentChar!=";"&&currentChar!=null){currentBlock+=currentChar;next()}if(currentChar==null){throw new Error("Statement or code block missing closure.")}blocks.push({value:currentBlock+currentChar,type:{"{":"begin",";":"statement"}[currentChar]});next()}}return blocks}function toSelector(preSelectorArray,deep){var selectors=preSelectorArray[0],i,j,k;for(i=1;i<deep;i++){var temp=[];for(j=0;j<selectors.length;j++){for(k=0;k<preSelectorArray[i].length;k++){temp.push(selectors[j]+preSelectorArray[i][k])}}selectors=temp}return"\n"+selectors.join(",")+"{\n"}
/*!
   * 🔪 - 把 SCSS 解析成 CSS 的算法实现
   * https://github.com/hai2007/algorithm.js/blob/master/scss.js
   *
   * author hai2007 < https://hai2007.gitee.io/sweethome >
   *
   * Copyright (c) 2021-present hai2007 走一步，再走一步。
   * Released under the MIT license
   */function scssToCss(source){var blocks=analyseBlock(source);var i,j,cssCode="",preSelectorArray=[],deep=0;for(i=0;i<blocks.length;i++){if(blocks[i].type=="comment-double"){cssCode+=blocks[i].value}else if(blocks[i].type=="comment-single"){cssCode+="\n/* "+blocks[i].value+" */\n"}else if(blocks[i].type=="begin"){var preSplit=blocks[i].value.split(",");var preSelect=[];for(j=0;j<preSplit.length;j++){preSelect[j]=preSplit[j].replace(/\{$/,"").trim();if(/^&/.test(preSelect[j])){preSelect[j]=preSelect[j].replace(/^&/,"")}else{preSelect[j]=" "+preSelect[j]}}preSelectorArray[deep]=preSelect;deep+=1}else if(blocks[i].type=="end"){deep-=1}else if(blocks[i].type=="statement"){j=1;var preType=blocks[i-j].type;while(["comment-double","comment-single"].indexOf(preType)>-1){j+=1;preType=blocks[i-j].type}if(["end","begin"].indexOf(preType)>-1){cssCode+=toSelector(preSelectorArray,deep)}cssCode+="\n"+blocks[i].value+"\n";j=1;var nextType=blocks[i+j].type;while(["comment-double","comment-single"].indexOf(nextType)>-1){j+=1;nextType=blocks[i+j].type}if(["end","begin"].indexOf(nextType)>-1){cssCode+="\n}\n"}}}return cssCode}function useStyle(){var styleElement=document.createElement("style");var head=document.head||document.getElementsByTagName("head")[0];styleElement.innerHTML=scssToCss("\n        #calendar-dialog{\n            font-family: serif;\n            .header {\n                text-align: center;\n                margin-bottom: 10px;\n                &>button {\n                    border: none;\n                    background-color: transparent;\n                    cursor: pointer;\n                    height: 20px;\n                    vertical-align: top;\n                    font-weight: 800;\n                    font-size: 20px;\n                    line-height: 20px;\n                }\n                &>h3 {\n                    display: inline-block;\n                    width: 180px;\n                    cursor: pointer;\n                }\n            }\n            .title>span,\n            .items>span {\n                display: inline-block;\n                width: 35px;\n                height: 35px;\n                line-height: 35px;\n                text-align: center;\n            }\n            .gray {\n                color: #c2bbbb;\n            }\n            [tag]{\n                cursor: pointer;\n                &:hover{\n                    background-color: #f1ecec;\n                    color: white;\n                }\n            }\n            .items{\n                &.dayview>span {\n                    width: 35px;\n                }\n\n                &.monthview>span {\n                    width: 60px;\n                    line-height: 60px;\n                    height: 60px;\n                }\n\n                &.yearview>span {\n                    width: 80px;\n                    line-height: 60px;\n                    height: 60px;\n                }\n            }\n        }\n        #calendar-dialog_close{\n            &:hover{\n                color: #211e1e !important;\n            }\n        }\n    ");styleElement.setAttribute("type","text/css");head.appendChild(styleElement)}var CalendarDialog=function CalendarDialog(initDate){var dialog=document.getElementById("calendar-dialog"),doit;if(!dialog){useStyle();xhtml.append(document.body,"<div id='calendar-dialog'\n                style='\n                position: fixed;\n                box-shadow: 0 0 7px 1px #9393a0;\n                border-radius: 5px;\n                background-color: white;\n                user-select: none;\n            '>\n            <div id='calendar-dialog_move' style='\n                font-size: 25px;\n                text-align: center;\n                cursor: move;\n                border-radius: 5px 5px 0 0;\n                line-height: 30px;\n                background-color: #f1ecec;\n                color: #938e8e;\n                padding: 10px 0;\n                margin-bottom: 10px;\n                font-weight: 800;\n            '>日历</div>\n            <div id='calendar-dialog_view' style='\n                padding:10px;\n                width:265px;\n            '></div>\n            <div id='calendar-dialog_close' style='\n                text-align: center;\n                padding: 10px;\n                background-color: #f1ecec;\n                color: #9e9e9e;\n                cursor: pointer;\n            '>关闭</div>\n        </div>");dialog=document.getElementById("calendar-dialog");dragdrop();xhtml.bind(document.getElementById("calendar-dialog_close"),"click",(function(){dialog.style.display="none"}))}dialog.style.display="block";selectDayView(initDate.year,initDate.month);var winSize={width:window.innerWidth,height:window.innerHeight};dialog.style.left=winSize.width*.5-125+"px";dialog.style.top=winSize.height*.5-150+"px";dialog.__doSelected__=function(year,month,day){doit({year:year,month:month,day:day})};return{then:function then(callback){doit=callback}}};if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=CalendarDialog}else{window.CalendarDialog=CalendarDialog}})();